<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>
            example
        </title>
        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
    </head>

    <body>
        <div id="reactTest">
        </div>
        <script src="pluginInfoTemplateResources/marked.min.js"></script>
        <script src="pluginInfoTemplateResources/react.min.js"></script>
        <script src="pluginInfoTemplateResources/react-dom.js"></script>
        <script src="pluginInfoTemplateResources/JSXTransformer.js">


        </script>
        <script type="text/jsx">
            
            console.log = function(message){
                logger.log(message);
            }
            
            window.onclick = function (e) {
                if (e.target.localName == 'a') {
                    console.log(e.target);
                     Bridge.openWebpage(e.target);
                     e.preventDefault();
                }
            }
            var _storeCallback;
            var _name;
            var _version;
            var _description;
            var _repository;
            var _pluginIndex;
            var _isUpdatable;
            var _isInstalled;
            
            function updatePluginInfo() {
                _name = pluginInfo.getPluginName();
                _version = pluginInfo.getVersion();
                _description = pluginInfo.getDescription();
                _repository = pluginInfo.getRepository();
                _isInstalled = pluginInfo.isInstalled();
                _isUpdatable = pluginInfo.isUpdatable();
                PluginStore.emitChange();
            }
            
            var PluginStore = {
                register: function(callback) {
                    _storeCallback = callback;
                },
                emitChange:function() {
                    _storeCallback();
                },
                
                getName: function() {
                    return _name;
                },
                getVersion:function() {
                    return _version;
                },
                getDescription: function() {
                    return _description;
                },
                getRepository: function() {
                    return _repository;
                },
                isUpdatable: function() {
                    return _isUpdatable;
                },
                isInstalled: function() {
                    return _isInstalled;
                }

            };
            
            var PluginInfo = React.createClass({  
                
                componentDidMount: function() {
                    PluginStore.register(this._change);
                },
         getInitialState: function() {
          return {pluginName: '',version:'',repository:'',description:'## helloWorld'};
         },
         _change: function() {
           this.setState({
               pluginName: PluginStore.getName(),
               version: PluginStore.getVersion(), 
               repository: PluginStore.getRepository(), 
               description: PluginStore.getDescription(),
               isInstalled:PluginStore.isInstalled(),
               isUpDateable:PluginStore.isUpdatable()
           });
         },
         _handleInstallClick: function(){
             if(this.state.isInstalled){
                Bridge.handleUnInstallClick();
             }
             else{
                Bridge.installPlugin();
             }
         },
         _handleUpdateClick: function(){
             Bridge.handleUpdateClick();
         },
         render: function() {
           if(!this.state.pluginName){
               return <div></div>;
           }
           var nameLine = this.state.pluginName;
           var versionLine = 'Verson: ' + this.state.version;
           var repositoryLine = 'Repository: ' + this.state.repository;
           
           var containerStyle = {
            marginTop: '15' // 'ms' is the only lowercase vendor prefix
           };
           
           var installBtnClassArg = 'btn pull-right';
           var installBtnText = '';
           if(this.state.isInstalled){
               installBtnClassArg += ' btn-danger';
               installBtnText= 'Uninstall Plugin';
           }else{
               installBtnClassArg += ' btn-success';
               installBtnText= 'Install Plugin';
           }
           var updateBtnClassArg = 'btn btn-warning pull-right';
           if(!this.state.isUpDateable){
            updateBtnClassArg += ' hide';
           }
           var descriptionHtml = marked(this.state.description, {sanitize: true});
           return   <div className="container-fluid" style={containerStyle}>
                        <div className="row">
                            <div className="col-xs-6">
                                <h1>{nameLine}</h1>
                            </div>
                            <div className="col-xs-6">
                                <a className={installBtnClassArg} onClick={this._handleInstallClick}><i className=
                                "fa fa-download" style={{marginRight:5}}></i>{installBtnText}</a>
                             <a className={updateBtnClassArg} style={{marginRight:5}} onClick={this._handleUpdateClick  }><i className=
                                "fa fa-arrow-circle-up" style={{marginRight:5}}></i>Update</a>
                            </div>
                        </div>
                        <div className="row">
                            <div className="col-md-12">
                                {versionLine}
                            </div>
                        </div>
                        <div className="row">
                            <div className="col-md-12">
                                {repositoryLine}
                            </div>
                        </div>
                        <div className="row">
                            <div className="col-md-12" dangerouslySetInnerHTML={{__html:descriptionHtml}}>
                            </div>
                        </div>
                    </div>
;
         }
       }); 
        
         ReactDOM.render(
           <PluginInfo />,
           document.getElementById('reactTest')
         );

        </script>
    </body>

</html>