<!-- ==============================================================

This is the build file that is used by ant to compile IGB.

Make sure that both 'ant' and 'javac' are in your path.

Make sure that the 'ext' directory exists and includes
  all needed external jar files.  Refer to the README.txt file
  for the list of needed jar files.

-->

<project name="IGB" default="usage" basedir=".">


  <!-- =================================================================== -->
  <!-- Initialization target                                               -->
  <!-- =================================================================== -->
  <target name="init">
    <tstamp/>

    <property name="Name" value="IGB"/>

    <echo message="----------- ${Name} ------------"/>

    <property name="build.compiler" value="modern"/>
    <property name="debug" value="on"/>
    <property name="optimize" value="off"/>
    <property name="deprecation" value="off"/>

    <!-- Define the source directories -->
    <property name="root.dir" value="."/>
    <property name="genoviz.dir" value="${root.dir}/genoviz_sdk"/>
    <property name="genoviz.src.dir" value="${genoviz.dir}/src"/>
    <property name="genometry.dir" value="${root.dir}/genometry"/>
    <property name="genometry.src.dir" value="${genometry.dir}/src"/>
    <property name="genometryImpl.dir" value="${root.dir}/genometryImpl"/>
    <property name="genometryImpl.src.dir" value="${genometryImpl.dir}/src"/>
    <property name="igb.dir" value="${root.dir}/igb"/>
    <property name="igb.src.dir" value="${igb.dir}/src"/>
    <property name="das2_server.dir" value="${root.dir}/das2_server"/>

    <!-- Define the source build directories -->
    <!--   (The source and class directories are the same)  -->
    <property name="classes.dir" value="${igb.dir}/src"/>

    <!-- Define the directory with external jar files -->
    <property name="lib.dir" value="${root.dir}/ext" />

    <!-- Define the output jar file -->
    <property name="igb.jar" value="${root.dir}/igb.jar"/>

    <!-- Define the output documentation directory -->
    <property name="api-docs.dir" value="${root.dir}/documentation/api-docs"/>

    <!-- Define the output executable jar file -->
    <property name="igb_exe.jar" value="${root.dir}/igb_exe.jar"/>
  </target>
  
  <target name="init-igb" depends="init">

    <fail unless="lib.dir">

    *************************************************************

    To use this ant build script:
    
    1. Obtain .jar files for:

       Jetty servlet container, version 4.1 or higher
       http://www.jettyserver.org/jetty/
    
       javax.servlet.jar 

       Note: IGB requires Xerces code, which ant uses.  When you
       run IGB on its own, you'll need to include the Xerces .jar
       file(s) in the java classpath.  Xerces project url is:
       http://xml.apache.org/xerces-j
       
    2. Place copies of those jar files in some directory.
    
    3. Let "ant" know the location of that directory by using a
       command like:
       
       "ant  -Dlib.dir=/home/gregg/lib  compile"

    *************************************************************

    </fail>
    <!-- All jar files in the "lib" directory will be used during compilation. -->
    <path id="project.class.path">
      <pathelement path="genoviz_sdk/genoviz.jar" />
      <pathelement path="genometry/genometry.jar" />
      <pathelement path="genometryImpl/genometryImpl.jar" />
      <fileset dir="${lib.dir}">
        <include name="**/*.jar"/>
      </fileset>
    </path>


  </target>

  <!-- =================================================================== -->
  <!-- Help on usage                                                       -->
  <!-- =================================================================== -->
  <target name="usage" description="(default) displays build menu">
    <echo message=""/>
    <echo message=""/>
    <echo message="IGB Build file"/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
    <echo message=" To compile IGB and create the igb.jar file, type 'ant jar'."/>
    <echo message=" To run IGB from inside ant, type 'ant run'."/>
    <echo message=""/>
    <echo message=" For a list of all possible ant targets, type 'ant -projecthelp'"/>
    <echo message=""/>
    <echo message="-------------------------------------------------------------"/>
    <echo message=""/>
    <echo message=""/>
  </target>

  <!-- =================================================================== -->
  <!-- Compiles GenoViz                                                     -->
  <!-- =================================================================== -->
  <target name="compile-genoviz" depends="init" 
    description="Compiles GenoViz">
    <ant dir="${genoviz.dir}" target="jar" inheritAll="false"/>
  </target>

  
  <!-- =================================================================== -->
  <!-- Compiles Genometry                                                  -->
  <!-- =================================================================== -->
  <target name="compile-genometry" depends="init" 
    description="Compiles Genometry (Interfaces)">
    <ant dir="${genometry.dir}" target="all" inheritAll="false"/>
  </target>
  
  <!-- =================================================================== -->
  <!-- Compiles GenometryImpl                                              -->
  <!-- =================================================================== -->
  <target name="compile-genometry-impl" depends="init,compile-genometry" 
    description="Compiles Genometry Implementations">
    <ant dir="${genometryImpl.dir}" target="all" inheritAll="false"/>
  </target>
  
  <!-- =================================================================== -->
  <!-- Compiles All                                                        -->
  <!-- =================================================================== -->
  <target name="compile" depends="init,init-igb,compile-genoviz,compile-genometry,compile-genometry-impl" 
    description="Compiles IGB">
    <mkdir dir="${classes.dir}"/>
    <javac destdir="${classes.dir}"
           debug="${debug}"
           deprecation="${deprecation}" 
           optimize="${optimize}"
           source="1.5">
      <src path="${igb.src.dir}"/>
      <classpath refid="project.class.path" />
    </javac>
    <!-- Copy all "resource" files into the classes directory -->
    <copy todir="${classes.dir}">
      <fileset dir="${igb.src.dir}">
        <exclude name="**/*.java"/>
      </fileset>
    </copy>
  </target>

  
  <!-- =================================================================== -->
  <!-- Creates the igb.jar                                                 -->
  <!-- =================================================================== -->
  <target name="jar" depends="compile" 
    description="Builds the IGB jar file.">
    <jar jarfile="${igb.jar}" update="false">
      <!-- Make sure to copy all "resource" files as well as class files -->
      <fileset dir="${classes.dir}">
       <exclude name="test/affymetrix/**"/>
       <exclude name="com/affymetrix/igb/test/**"/>
       <exclude name="**/*.java"/>
       <exclude name="**/package.html"/>
       <exclude name="**/.*"/>
      </fileset>
    </jar>

  </target>

  <!-- =================================================================== -->
  <!-- Creates an executable, large .jar file                              -->
  <!-- =================================================================== -->
  <!-- Contents of all external jar files will be included  -->
    
  <target name="exe" depends="jar" 
          description="generate executable .jar file" >
      <jar jarfile="${igb_exe.jar}" update="false">
      <manifest>
        <attribute name="Main-Class" value="com.affymetrix.igb.IGB"/>
      </manifest>
      <metainf file="LICENSE.html"/>
      <metainf file="NOTICES.txt"/>
      <zipfileset src="${igb.jar}"/>
      <zipfileset src="genometry/genometry.jar"/>
      <zipfileset src="genometryImpl/genometryImpl.jar"/>
      <zipfileset src="genoviz_sdk/genoviz.jar"/>
      <zipgroupfileset dir="${lib.dir}">
        <include name="**/*.jar"/>
      </zipgroupfileset>
    </jar>
  </target>

  <!-- =================================================================== -->
  <!-- Clean restores distribution to original state                       -->
  <!-- =================================================================== -->
  <target name="clean" depends="init"
    description="Restores distribution to its original state">
    <ant dir="${genoviz.dir}" target="clean" inheritAll="false"/>
    <ant dir="${genometry.dir}" target="clean" inheritAll="false"/>
    <ant dir="${genometryImpl.dir}" target="clean" inheritAll="false"/>
    <ant dir="${das2_server.dir}" target="clean" inheritAll="false"/>
    <delete file="${igb.jar}"/>
    <delete file="${igb_exe.jar}"/>
    <delete dir="${api-docs.dir}"/>
    <delete>
      <fileset dir="${root.dir}">
        <include name="**/*.class"/>
      </fileset>
    </delete>
  </target>


<!-- Note: Output from IGB will be easier to read if you run it from the 
      command line rather than from inside of ant. But you can run it from
      ant if you wish.  -->
  <target name="run" depends="init-igb,jar"
    description="Runs IGB (rebuilding it first, if needed).">
    <java fork="true" classname="com.affymetrix.igb.IGB">
      <!-- Note: you can change the amout of memory to use here. -->
      <jvmarg value="-mx256m"/>
      <!--  Note: you can specify here which prefs file(s) to include. -->
      <arg value="-prefs"/>
      <arg value="${igb.src.dir}/igb_prefs.xml"/>
      <classpath>
        <pathelement location="${igb.jar}"/>
        <path refid="project.class.path"/>
      </classpath>
    </java>
  </target>


  <target name="docs" depends="init-igb" description="Builds javadocs">
    <mkdir dir="${api-docs.dir}"/>
    <javadoc 
           destdir="${api-docs.dir}"
           author="true"
           version="true"
           use="true"
           windowtitle="${Name} API"
           maxmemory="64m"
           access="private"
           verbose="false"
           splitindex="false"
           source="1.4"
           >
      <classpath refid="project.class.path"/>
      <packageset dir="${igb.src.dir}"/>
      <packageset dir="${genoviz.src.dir}"/>
      <packageset dir="${genometry.src.dir}"/>
      <packageset dir="${genometryImpl.src.dir}"/>
      <doctitle><![CDATA[<h1>IGB - Integrated Genome Browser</h1>]]></doctitle>
      <bottom><![CDATA[<i>Copyright &#169; Affymetrix, Inc.</i>]]></bottom>
    </javadoc>
    <echo>
     ***********************************************
       Javadocs were created in the directory: 
       ${api-docs.dir}
     ***********************************************
    </echo>
  </target> 

</project>

<!-- End of file -->


