<!--                                                                 -->
<!-- Test file for new, improved build system.  There are still a    -->
<!-- number of problems to be worked out.  This files does not yet   -->
<!-- have test, demo, or run targets. The test and demo targets may  -->
<!-- have to be one off, or the targets need to be added to all sub- -->
<!-- projects via the common.xml.  The common.xml should also be     -->
<!-- be able to be used on a sub-project alone.                      -->
<!--                                                                 -->
<project name="master" basedir=".">
	<target name="init">
		<property name="genoviz"       value="${basedir}/genoviz_sdk" />
		<property name="genometry"     value="${basedir}/genometry" />
		<property name="genometryImpl" value="${basedir}/genometryImpl" />
		<property name="igb"           value="${basedir}/igb" />
		<property name="das2server"    value="${basedir}/das2_server" />

		<path id="classpath">
			<pathelement path="${genoviz}/build" />
			<pathelement path="${genometry}/build" />
			<pathelement path="${genometryImpl}/build" />
			<pathelement path="${igb}/build" />
			<pathelement path="${das2server}/build" />
			<fileset dir="${basedir}/ext">
				<include name="**/*.jar"/>
			</fileset>
			<fileset dir="${basedir}/ext2">
				<include name="**/*.jar"/>
			</fileset>
		</path>

		<dirset id="docdirs" dir="${basedir}">
			<include name="${genoviz}/src" />
			<include name="${genometry}/src" />
			<include name="${genometryImpl}/src" />
			<include name="${igb}/src" />
			<include name="${das2server}/src" />
		</dirset>
	</target>

	<target name="compile" depends="init">
		<iterate target="compile" />
	</target>

	<target name="jar" depends="init">
		<iterate target="jar" />
	</target>

	<target name="all" depends="exe">
		<iterate target="all" />
	</target>

	<target name="clean" depends="init">
		<iterate target="clean" />
		<delete file="igb_exe.jar"/>
	</target>

	<target name="docs" depends="init">
		<mkdir dir="${docs.dir}"/>
		<javadoc destdir="${docs.dir}" author="true" version="true" use="true" windowtitle="Integrated Genome Browser API" maxmemory="128m" access="private" verbose="false" splitindex="false" source="1.5">
			<link href="http://java.sun.com/j2se/1.5.0/docs/api/"/>
			<link href="http://java.sun.com/javaee/5/docs/api/"/>
			<classpath refid="classpath"/>
			<packageset refid="docdirs"/>
			<doctitle><![CDATA[<h1>IGB - Integrated Genome Browser</h1>]]></doctitle>
			<bottom><![CDATA[<i>Copyright &#169; Affymetrix, Inc.</i>]]></bottom>
		</javadoc>
	</target>

	<target name="exe" depends="jar">
		<jar jarfile="igb_exe.jar" update="false">
			<manifest>
				<attribute name="Main-Class" value="com.affymetrix.igb.IGB"/>
			</manifest>
			<metainf file="LICENSE.html"/>
			<metainf file="NOTICES.txt"/>
			<zipgroupfileset dir="dist">
				<exclude name="das2server.jar" />
				<include name="**/*.jar"/>
			</zipgroupfileset>
			<zipgroupfileset dir="ext">
				<include name="**/*.jar"/>
			</zipgroupfileset>
		</jar>
	</target>

	<!--                                                                 -->
	<!-- Macro to pass targets to each sub project.  All sub projects    -->
	<!-- are build using common.xml.                                     -->
	<!--                                                                 -->
	<macrodef name="iterate">
		<attribute name="target" default=""/>
		<sequential>
			<!-- this class path should be moved to common.xml -->
			<subant target="@{target}" genericantfile="common.xml">
				<property name="dist.dir" location="${basedir}/dist" />
				<property name="docs.dir" location="${basedir}/documentation/api-docs" />
				<reference refid="classpath" />
				<!-- multiple dirsets ensure dependency ordering -->
				<dirset dir="${basedir}">
					<include name="genoviz_sdk" />
					<include name="genometry" />
				</dirset>
				<dirset dir="${basedir}">
					<include name="genometryImpl" />
				</dirset>
				<dirset dir="${basedir}">
					<include name="igb" />
				</dirset>
				<dirset dir="${basedir}">
					<include name="das2_server" />
				</dirset>
			</subant>
		</sequential>
	</macrodef>
</project>
