<project>
	
	<target name="common-init" depends="init,compiler-def-args,extras-init">
		<tstamp/>

		<!-- directory paths -->
		<property name="root.dir"     value="${basedir}" />
		
		<taskdef name="propertyregex" classname="net.sf.antcontrib.property.RegexTask" classpathref="contrib.path" />
		<propertyregex property="appShortVersion" input="${appVersion}" regexp="(\d+\.\d+)" select="\1" defaultValue="${appVersion}" />

		<!-- JNLP Webstart -->
		<property name="jnlp.dir" value="${igb}/etc" />
		<property name="jnlp.version"   value="${appShortVersion}" />
		<property name="jnlp.codebase"  value="http://bioviz.org/igb/releases/igb-8.0" />
		<property name="jnlp.icon.name" value="igb.gif" />
		<property name="jnlp.icon.path" value="${common}/resources/images/${jnlp.icon.name}" />
		<property name="jnlp.splashicon.name" value="igb_splash.gif" />
		<property name="jnlp.splashicon.path" value="${common}/resources/images/${jnlp.splashicon.name}" />
	

		<!-- global compiler defaults -->
		<property name="build.compiler"         value="modern" />
		<property name="ant.build.javac.target" value="6" />
		<property name="ant.build.javac.source" value="6" />

		<!-- signjar defaults -->
		<property file="${user.home}/.keystore.properties" />
		<property name="jar.sign.keystore"      value="${user.home}/.keystore" />
		<property name="jar.sign.keystore.pass" value="changeit" />
		<property name="jar.sign.alias"         value="igb" />
		<property name="jar.sign.alias.pass"    value="${jar.sign.keystore.pass}" />

		<!-- javadoc defaults -->
		<property name="javadoc.src.version" value="6" />

		<!-- Location of JUnit -->
		<!-- OS X and Debian do not appear to have junit in ant's path -->
		<property name="junit.jar"       value="${basedir}/ext/junit.jar" />

		<!-- Java VM configuration -->
		<property name="igb.jvmargs" value="" />
		<property name="igb.maxmem" value="1024m" />


		<filter token="build.customization"  value="${build.customization}" />
		<filter token="jnlp.version"  value="${jnlp.version}" />
		<filter token="jnlp.codebase" value="${jnlp.codebase}" />
		<filter token="jnlp.icon.name" value="${jnlp.icon.name}" />
		<filter token="jnlp.splashicon.name" value="${jnlp.splashicon.name}" />
		<filter token="igb.jar.name" value="${igb.jar.name}" />
		<filter token="igb.jar.large.name" value="${igb.jar.large.name}" />
		<filter token="igb.jar.5GB.name" value="${igb.jar.5GB.name}" />

	</target>

	<target name="compiler-def-args">
		<!-- compiler defaults passed to javac -->
		<property name="debug"         value="on" />
		<property name="deprecation"   value="off"/>
		<property name="compiler.args" value="-Xlint:all,-serial,-path"/>
	</target>
	
	<target name="extras-init">
		<path id="contrib.path">
			<fileset dir="${lib.dir}/ant-contrib-1.0b3">
				<include name="*.jar" />
			</fileset>
		</path>
	</target>
	 
	<presetdef name="my.javac">
		<javac srcdir="${src.dir}" classpath="${classpath}" debug="${debug}" deprecation="${deprecation}" includeantruntime="false">
			<compilerarg compiler="modern" line="${compiler.args}" />
		</javac>
	</presetdef>

	<presetdef name="my.javac_checker">
		<!-- Be sure to name your new javac executable "javac_checker" -->
		<javac fork="yes" executable="javac_checker" srcdir="${src.dir}" classpath="${classpath}">
			<compilerarg value="-version"/>
			<compilerarg line="-processor checkers.nullness.NullnessChecker"/>
			<compilerarg value="-implicit:class"/>
		</javac>
	</presetdef>


	<presetdef name="my.javadoc">
		<javadoc packagenames="*" destdir="${docs.dir}" author="true" version="true" use="true" windowtitle="${name}" maxmemory="128m" access="private" verbose="false" splitindex="false" source="${javadoc.src.version}">
			<doctitle><![CDATA[<h1>${name}</h1>]]></doctitle>
			<bottom><![CDATA[<i>Copyright &#169; Affymetrix, Inc.</i>]]></bottom>
		</javadoc>
	</presetdef>

	<presetdef name="my.signjar">
		<signjar alias="${jar.sign.alias}" storepass="${jar.sign.keystore.pass}" keystore="${jar.sign.keystore}" keypass="${jar.sign.alias.pass}"  />
	</presetdef>

</project>
